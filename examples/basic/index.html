<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BukaJS Basic Example</title>
    <style>
      body {
        margin: 0;
        font-family: system-ui, sans-serif;
        background: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
      }

      .upload-section {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        text-align: center;
      }

      .file-input {
        margin: 20px 0;
      }

      .file-input input[type="file"] {
        padding: 10px;
        border: 2px dashed #ddd;
        border-radius: 6px;
        margin-right: 10px;
      }

      .load-btn {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
      }

      .load-btn:hover {
        background: #0056b3;
      }

      .url-input {
        width: 300px;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-right: 10px;
      }

      .viewer-container {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        height: 600px;
        overflow: hidden;
      }

      #buka-viewer {
        width: 100%;
        height: 100%;
      }

      .sample-links {
        margin: 20px 0;
      }

      .sample-links a {
        display: inline-block;
        margin: 5px 10px;
        padding: 8px 15px;
        background: #f8f9fa;
        color: #007bff;
        text-decoration: none;
        border-radius: 4px;
        border: 1px solid #dee2e6;
      }

      .sample-links a:hover {
        background: #e9ecef;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        border: 1px solid #f5c6cb;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      /* Essential BukaJS styles */
      .buka-viewer {
        display: flex;
        flex-direction: column;
        height: 100%;
        font-family: system-ui, sans-serif;
      }

      .buka-toolbar {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.5rem;
        border-bottom: 1px solid #ddd;
        background: #f5f5f5;
        flex-shrink: 0;
      }

      .buka-toolbar-section {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .buka-btn {
        padding: 0.25rem 0.5rem;
        border: 1px solid #ccc;
        background: white;
        cursor: pointer;
        border-radius: 3px;
        font-size: 14px;
      }

      .buka-btn:hover {
        background: #e9e9e9;
      }

      .buka-main {
        display: flex;
        flex: 1;
        overflow: hidden;
      }

      .buka-sidebar {
        width: 200px;
        border-right: 1px solid #ddd;
        background: #fafafa;
        overflow-y: auto;
        flex-shrink: 0;
      }

      .buka-content {
        flex: 1;
        position: relative;
        overflow: auto;
      }

      .buka-document-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
      }

      .buka-page-info {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .buka-page-input {
        width: 60px;
        padding: 0.25rem;
        border: 1px solid #ccc;
        border-radius: 3px;
        text-align: center;
      }

      .buka-search-input {
        padding: 0.25rem;
        border: 1px solid #ccc;
        border-radius: 3px;
      }

      .buka-thumbnails {
        padding: 10px;
      }

      .buka-thumbnail {
        width: 120px;
        height: 160px;
        margin-bottom: 10px;
        background: white;
        border: 2px solid transparent;
        border-radius: 4px;
        cursor: pointer;
        overflow: hidden;
        transition: all 0.2s;
      }

      .buka-thumbnail:hover {
        border-color: #007bff;
      }

      .buka-thumbnail-active {
        border-color: #007bff !important;
        background-color: #f0f8ff;
      }

      .buka-loading {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 20px;
        color: #666;
      }

      .buka-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #007bff;
        border-radius: 50%;
        animation: buka-spin 1s linear infinite;
        margin-bottom: 10px;
      }

      @keyframes buka-spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .buka-pdf-canvas {
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>BukaJS - Universal Document Viewer</h1>

      <div class="upload-section">
        <h3>Load a Document</h3>
        <p>
          Upload a file or provide a URL to view PDF, DOCX, XLSX, PPTX, CSV, and
          Image documents
        </p>

        <div class="file-input">
          <input
            type="file"
            id="fileInput"
            accept=".pdf,.docx,.xlsx,.pptx,.csv,.png,.jpg,.jpeg,.svg"
          />
          <button class="load-btn" onclick="loadFromFile()">Load File</button>
        </div>

        <div class="url-input-section">
          <input
            type="url"
            id="urlInput"
            class="url-input"
            placeholder="Enter document URL..."
          />
          <button class="load-btn" onclick="loadFromURL()">Load URL</button>
        </div>

        <div class="sample-links">
          <strong>Sample Documents:</strong>
          <a
            href="#"
            onclick="loadSample('https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf')"
            >Sample PDF</a
          >
          <a
            href="#"
            onclick="loadSample('https://via.placeholder.com/800x600/4A90E2/FFFFFF?text=Sample+Image.png')"
            >Sample Image</a
          >
          <a
            href="#"
            onclick="loadSample('data:text/csv;base64,' + btoa('Name,Age,City\\nJohn,25,New York\\nJane,30,San Francisco\\nBob,35,Chicago'))"
            >Sample CSV</a
          >
          <a href="#" onclick="createMockPPTX()">Sample Presentation</a>
        </div>

        <div id="error-container"></div>
        <div id="loading-container"></div>
      </div>

      <div class="viewer-container">
        <div id="buka-viewer"></div>
      </div>
    </div>

    <script src="../../dist/index.js"></script>
    <script src="../../dist/renderers/pdf.js"></script>
    <script src="../../dist/renderers/image.js"></script>
    <script src="../../dist/renderers/docx.js"></script>
    <script src="../../dist/renderers/xlsx.js"></script>
    <script src="../../dist/renderers/presentation.js"></script>

    <script>
      const { BukaViewer, EVENTS, RendererFactory, SUPPORTED_FORMATS } = BukaJS;

      if (typeof BukaJSPDFRenderer !== "undefined") {
        RendererFactory.register(
          SUPPORTED_FORMATS.PDF,
          BukaJSPDFRenderer.PDFRenderer
        );
      }
      if (typeof BukaJSImageRenderer !== "undefined") {
        RendererFactory.register(
          SUPPORTED_FORMATS.IMAGE_PNG,
          BukaJSImageRenderer.ImageRenderer
        );
        RendererFactory.register(
          SUPPORTED_FORMATS.IMAGE_JPEG,
          BukaJSImageRenderer.ImageRenderer
        );
        RendererFactory.register(
          SUPPORTED_FORMATS.IMAGE_SVG,
          BukaJSImageRenderer.ImageRenderer
        );
      }
      if (typeof BukaJSDocxRenderer !== "undefined") {
        RendererFactory.register(
          SUPPORTED_FORMATS.DOCX,
          BukaJSDocxRenderer.DocxRenderer
        );
      }
      if (typeof BukaJSXlsxRenderer !== "undefined") {
        RendererFactory.register(
          SUPPORTED_FORMATS.XLSX,
          BukaJSXlsxRenderer.XlsxRenderer
        );
        RendererFactory.register("text/csv", BukaJSXlsxRenderer.XlsxRenderer);
      }
      if (typeof BukaJSPresentationRenderer !== "undefined") {
        RendererFactory.register(
          SUPPORTED_FORMATS.PPTX,
          BukaJSPresentationRenderer.PresentationRenderer
        );
        RendererFactory.register(
          SUPPORTED_FORMATS.PPT,
          BukaJSPresentationRenderer.PresentationRenderer
        );
      }

      let viewer;

      function initViewer() {
        const container = document.getElementById("buka-viewer");
        viewer = new BukaViewer(container, {
          enableAnnotations: true,
          enableSearch: true,
          enableThumbnails: true,
          enableToolbar: true,
          enableCache: true,
          theme: "default", // Can be 'default', 'dark', or 'tailwind'
        });

        viewer.on(EVENTS.DOCUMENT_LOADED, (data) => {
          console.log("Document loaded:", data);
          showMessage(
            `Document loaded successfully! ${data.totalPages} pages.`,
            "success"
          );
        });

        viewer.on(EVENTS.ERROR, (error) => {
          console.error("Viewer error:", error);
          showError(`Error: ${error.message}`);
        });

        viewer.on(EVENTS.PAGE_CHANGED, (data) => {
          console.log("Page changed:", data);
        });

        viewer.on(EVENTS.SEARCH_RESULT, (data) => {
          console.log("Search results:", data);
          showMessage(`Found ${data.results.length} search results`, "info");
        });
      }

      window.loadFromFile = async function () {
        const fileInput = document.getElementById("fileInput");
        const file = fileInput.files[0];

        if (!file) {
          showError("Please select a file first.");
          return;
        }

        try {
          showLoading("Loading document...");
          await viewer.load(file);
          clearMessages();
        } catch (error) {
          showError(`Failed to load file: ${error.message}`);
        }
      };

      window.loadFromURL = async function () {
        const urlInput = document.getElementById("urlInput");
        const url = urlInput.value.trim();

        if (!url) {
          showError("Please enter a URL first.");
          return;
        }

        try {
          showLoading("Loading document...");
          await viewer.load(url);
          clearMessages();
        } catch (error) {
          showError(`Failed to load URL: ${error.message}`);
        }
      };

      window.loadSample = async function (url) {
        document.getElementById("urlInput").value = url;
        try {
          showLoading("Loading sample document...");
          await viewer.load(url);
          clearMessages();
        } catch (error) {
          showError(`Failed to load sample: ${error.message}`);
        }
      };

      window.createMockPPTX = async function () {
        try {
          showLoading("Creating sample presentation...");

          const mockData = new ArrayBuffer(1024);
          const mockFile = new File([mockData], "sample.pptx", {
            type: "application/vnd.openxmlformats-officedocument.presentationml.presentation",
          });

          await viewer.load(mockFile);
          clearMessages();
        } catch (error) {
          showError(`Failed to create sample presentation: ${error.message}`);
        }
      };

      function showError(message) {
        const container = document.getElementById("error-container");
        container.innerHTML = `<div class="error">${message}</div>`;
        clearLoading();
      }

      function showMessage(message, type = "info") {
        const container = document.getElementById("error-container");
        const className =
          type === "success" ? "success" : type === "info" ? "info" : "error";
        container.innerHTML = `<div class="${className}" style="background: ${
          type === "success" ? "#d4edda" : "#d1ecf1"
        }; color: ${
          type === "success" ? "#155724" : "#0c5460"
        }; padding: 10px; border-radius: 4px; margin: 10px 0;">${message}</div>`;
        clearLoading();

        if (type !== "error") {
          setTimeout(clearMessages, 3000);
        }
      }

      function showLoading(message) {
        const container = document.getElementById("loading-container");
        container.innerHTML = `<div class="loading">${message}</div>`;
      }

      function clearLoading() {
        document.getElementById("loading-container").innerHTML = "";
      }

      function clearMessages() {
        document.getElementById("error-container").innerHTML = "";
        clearLoading();
      }

      document.addEventListener("DOMContentLoaded", initViewer);
    </script>
  </body>
</html>
